!function(a){var b={init:function(c){return this.each(function(){var d=this,e=a(d).empty();d.opt=a.extend(!0,{},a.fn.raty.defaults,c),e.data("settings",d.opt),d.opt.number=b.between(d.opt.number,0,5),"/"!=d.opt.path.substring(d.opt.path.length-1,d.opt.path.length)&&(d.opt.path+="/"),"function"==typeof d.opt.score&&(d.opt.score=d.opt.score.call(d)),d.opt.score&&(d.opt.score=b.between(d.opt.score,0,d.opt.number));for(var f=1;f<=d.opt.number;f++)a("<img />",{src:d.opt.path+(!d.opt.score||d.opt.score<f?d.opt.starOff:d.opt.starOn),alt:f,title:f<=d.opt.hints.length&&null!==d.opt.hints[f-1]?d.opt.hints[f-1]:f}).appendTo(d),d.opt.space&&e.append(f<d.opt.number?"&#160;":"");d.stars=e.children('img:not(".raty-cancel")'),d.score=a("<input />",{type:"hidden",name:d.opt.scoreName}).appendTo(d),d.opt.score&&d.opt.score>0&&(d.score.val(d.opt.score),b.roundStar.call(d,d.opt.score)),d.opt.iconRange&&b.fill.call(d,d.opt.score),b.setTarget.call(d,d.opt.score,d.opt.targetKeep);var g=d.opt.space?4:0,h=d.opt.width||d.opt.number*d.opt.size+d.opt.number*g;d.opt.cancel&&(d.cancel=a("<img />",{src:d.opt.path+d.opt.cancelOff,alt:"x",title:d.opt.cancelHint,"class":"raty-cancel"}),"left"==d.opt.cancelPlace?e.prepend("&#160;").prepend(d.cancel):e.append("&#160;").append(d.cancel),h+=d.opt.size+g),d.opt.readOnly?(b.fixHint.call(d),d.cancel&&d.cancel.hide()):(e.css("cursor","pointer"),b.bindAction.call(d)),e.css("width",h)})},between:function(a,b,c){return Math.min(Math.max(parseFloat(a),b),c)},bindAction:function(){var c=this,d=a(c);d.mouseleave(function(){var a=c.score.val()||void 0;b.initialize.call(c,a),b.setTarget.call(c,a,c.opt.targetKeep),c.opt.mouseover&&c.opt.mouseover.call(c,a)});var e=c.opt.half?"mousemove":"mouseover";c.opt.cancel&&c.cancel.mouseenter(function(){a(this).attr("src",c.opt.path+c.opt.cancelOn),c.stars.attr("src",c.opt.path+c.opt.starOff),b.setTarget.call(c,null,!0),c.opt.mouseover&&c.opt.mouseover.call(c,null)}).mouseleave(function(){a(this).attr("src",c.opt.path+c.opt.cancelOff),c.opt.mouseover&&c.opt.mouseover.call(c,c.score.val()||null)}).click(function(a){c.score.removeAttr("value"),c.opt.click&&c.opt.click.call(c,null,a)}),c.stars.bind(e,function(e){var f=parseInt(this.alt,10);if(c.opt.half){var g=parseFloat((e.pageX-a(this).offset().left)/c.opt.size),h=g>.5?1:.5;f=parseFloat(this.alt)-1+h,b.fill.call(c,f),c.opt.precision&&(f=f-h+g),b.showHalf.call(c,f)}else b.fill.call(c,f);d.data("score",f),b.setTarget.call(c,f,!0),c.opt.mouseover&&c.opt.mouseover.call(c,f,e)}).click(function(a){c.score.val(c.opt.half||c.opt.precision?d.data("score"):this.alt),c.opt.click&&c.opt.click.call(c,c.score.val(),a)})},cancel:function(c){return a(this).each(function(){var d=this,e=a(d);return e.data("readonly")===!0?this:(c?b.click.call(d,null):b.score.call(d,null),void d.score.removeAttr("value"))})},click:function(c){return a(this).each(function(){return a(this).data("readonly")===!0?this:(b.initialize.call(this,c),this.opt.click?this.opt.click.call(this,c):b.error.call(this,'you must add the "click: function(score, evt) { }" callback.'),void b.setTarget.call(this,c,!0))})},error:function(b){a(this).html(b),a.error(b)},fill:function(a){for(var b,c,d,e=this,f=e.stars.length,g=0,h=1;f>=h;h++)b=e.stars.eq(h-1),e.opt.iconRange&&e.opt.iconRange.length>g?(c=e.opt.iconRange[g],d=e.opt.single?h==a?c.on||e.opt.starOn:c.off||e.opt.starOff:a>=h?c.on||e.opt.starOn:c.off||e.opt.starOff,h<=c.range&&b.attr("src",e.opt.path+d),h==c.range&&g++):(d=e.opt.single?h==a?e.opt.starOn:e.opt.starOff:a>=h?e.opt.starOn:e.opt.starOff,b.attr("src",e.opt.path+d))},fixHint:function(){var b=a(this),c=parseInt(this.score.val(),10),d=this.opt.noRatedMsg;!isNaN(c)&&c>0&&(d=c<=this.opt.hints.length&&null!==this.opt.hints[c-1]?this.opt.hints[c-1]:c),b.data("readonly",!0).css("cursor","default").attr("title",d),this.score.attr("readonly","readonly"),this.stars.attr("title",d)},getScore:function(){var b,c=[];return a(this).each(function(){b=this.score.val(),c.push(b?parseFloat(b):void 0)}),c.length>1?c:c[0]},readOnly:function(c){return this.each(function(){var d=a(this);return d.data("readonly")===c?this:(this.cancel&&(c?this.cancel.hide():this.cancel.show()),c?(d.unbind(),d.children("img").unbind(),b.fixHint.call(this)):(b.bindAction.call(this),b.unfixHint.call(this)),void d.data("readonly",c))})},reload:function(){return b.set.call(this,{})},roundStar:function(a){var b=(a-Math.floor(a)).toFixed(2);if(b>this.opt.round.down){var c=this.opt.starOn;b<this.opt.round.up&&this.opt.halfShow?c=this.opt.starHalf:b<this.opt.round.full&&(c=this.opt.starOff),this.stars.eq(Math.ceil(a)-1).attr("src",this.opt.path+c)}},score:function(){return arguments.length?b.setScore.apply(this,arguments):b.getScore.call(this)},set:function(b){return this.each(function(){var c=a(this),d=c.data("settings"),e=c.clone().removeAttr("style").insertBefore(c);c.remove(),e.raty(a.extend(d,b))}),a(this.selector)},setScore:function(c){return a(this).each(function(){return a(this).data("readonly")===!0?this:(b.initialize.call(this,c),void b.setTarget.call(this,c,!0))})},setTarget:function(c,d){if(this.opt.target){var e=a(this.opt.target);0==e.length&&b.error.call(this,"target selector invalid or missing!");var f=c;f=d&&void 0!==f?"hint"==this.opt.targetType?null===f&&this.opt.cancel?this.opt.cancelHint:this.opt.hints[Math.ceil(f-1)]:this.opt.precision?parseFloat(f).toFixed(1):parseInt(f,10):this.opt.targetText,this.opt.targetFormat.indexOf("{score}")<0&&b.error.call(this,'template "{score}" missing!'),null!==c&&(f=this.opt.targetFormat.toString().replace("{score}",f)),e.is(":input")?e.val(f):e.html(f)}},showHalf:function(a){var b=(a-Math.floor(a)).toFixed(1);b>0&&.6>b&&this.stars.eq(Math.ceil(a)-1).attr("src",this.opt.path+this.opt.starHalf)},initialize:function(a){a=a?b.between(a,0,this.opt.number):0,b.fill.call(this,a),a>0&&(this.opt.halfShow&&b.roundStar.call(this,a),this.score.val(a))},unfixHint:function(){for(var b=0;b<this.opt.number;b++)this.stars.eq(b).attr("title",b<this.opt.hints.length&&null!==this.opt.hints[b]?this.opt.hints[b]:b);a(this).data("readonly",!1).css("cursor","pointer").removeAttr("title"),this.score.attr("readonly","readonly")}};a.fn.raty=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist!"):b.init.apply(this,arguments)},a.fn.raty.defaults={cancel:!1,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["10","20","30","40","50","60","70","80","90","100"],iconRange:void 0,mouseover:void 0,noRatedMsg:"not rated yet",number:10,path:"img/",precision:!1,round:{down:.25,full:.6,up:.76},readOnly:!1,score:void 0,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:void 0,targetFormat:"{score}",targetKeep:!1,targetText:"",targetType:"hint",width:void 0}}(jQuery);